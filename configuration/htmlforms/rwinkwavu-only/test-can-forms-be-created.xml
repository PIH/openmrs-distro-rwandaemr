<htmlform
		htmlformUuid="ee66feb5-4dc9-4ae0-af31-45ffa398ae5c"
		formUuid="429b1126-4c0a-409e-b169-fbe4af6a0b3b"
		formName="test can forms be created"
		formDescription="lkm"
		formVersion="1.0"
		formEncounterType="57d9672b-872a-46d2-8ae9-2b85fd31c4f2"
		formPublished="false"
		formRetired="false"
>
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const canvas = document.getElementById("signature-pad");
			const ctx = canvas.getContext("2d");
			let isDrawing = false;

			canvas.addEventListener("mousedown", (e) => {
				isDrawing = true;
				ctx.beginPath();
				ctx.moveTo(e.offsetX, e.offsetY);
			});

			canvas.addEventListener("mousemove", (e) => {
				if (isDrawing) {
					ctx.lineTo(e.offsetX, e.offsetY);
					ctx.stroke();
				}
			});

			canvas.addEventListener("mouseup", () => {
				isDrawing = false;
			});

			document.getElementById("clear-signature").addEventListener("click", () => {
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				document.getElementById("signature-display").src = ""; // Clear displayed image
			});

			document.getElementById("save-signature").addEventListener("click", () => {
				// Display the signature image
				const signatureDataUrl = canvas.toDataURL("image/png");
				const signatureImage = document.getElementById("signature-display");
				signatureImage.src = signatureDataUrl;

				// Set the data on the form
				const signatureFormField = getField('signature-data-obs.value');
				const signatureFormFieldName = jq(signatureFormField).attr('name');
				canvas.toBlob((signatureData) => {
					htmlForm.addBinaryData(signatureFormFieldName, signatureData, "signature.png");
				});
			});
		});
	</script>

	<body>
		<table border="2" cellspacing="0" cellpadding="6" width="100%">
			<tr>
				<td>
					Date:
					<encounterDate default="today" />
				</td>
				<td>
					Health Facility:
					<encounterLocation default="GlobalProperty:billing.defaultLocation" />
				</td>
				<td>
					Provider:
					<encounterProvider default="currentUser" />
				</td>
			</tr>
		</table>

		<section>
			<div>
				<fieldset>
					<legend>Signature</legend>
					<div>
						<!-- Signature Canvas -->
						<canvas id="signature-pad" width="400" height="150" style="border:1px solid #000;"/>
						<button type="button" id="clear-signature">Clear</button>
						<button type="button" id="save-signature">Save to Observation</button>

						<!-- Display Saved Signature -->
						<div>
							<p>Saved Signature:</p>
							<img id="signature-display" alt="No signature saved" style="border:1px solid #ccc; max-width:400px; height:auto;" />
						</div>

						<!-- Complex Observation Field -->
						<obs
								conceptId="2601bc72-71ff-40a9-bc64-fe6ecdb8b0fd"
								complexView="full"
								answerType="complex"
								id="signature-data-obs"
						/>
					</div>
				</fieldset>
			</div>
		</section>

		<submit />
	</body>
</htmlform>